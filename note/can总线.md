# can总线

## 什么是can总线

计算机各个部件共同的通信干线
是一种差分总线
差分：根据两根线的电压差不同，传递不同的信息
此外还有单端总线，只有一根线，根据线上电压的不同范围，传递不同信息

## can总线优点

1. 速度高
2. 距离远
3. 容错性强：电波干扰时，两根线电压会变 (应该是因为，电流通过时会产生感应磁场，感应磁场会产生感应电动势，导致电压改变...吧) ，但是电压差不会变，因此没有影响。
4. 多主机

## can电平

1. 两根线：can Hi、can Lo（低侧）

2. 高速can：正压差（h线比l线高） -> 隐性电平“1”   反之 显性电平 “0” 

3. 低速can：正压差（l线比h线高）。。。（同上）

## can位定义

can位就是0/1这些二进制位

can位有4段：同步段、传播段、相位缓冲段1、2

时间量子：can位的时间分成很多时间量子

传播段时间要大于延迟时间，因为传播段是用来中和延迟时间的

## can帧硬同步

1. 一个设备发送can帧时，它作为发送节点，会先发送一个起始位，

2. 接收节点b的起始位跟a会不同步，通过硬同步使起始位同步

3. 每一帧发送前发生一次硬同步，发送帧里面的数据时，不发生硬同步，而发生重同步

## 重同步

1. 接收节点起始位在发送节点前：pbs1延长

2. 接收节点起始位在发送节点后：pbs2缩短

## 数据帧

### 基本数据帧

帧头 | 11位id号  |  远程帧请求位、id拓展位（用了就要标为1）、保留位  |  数据长度（4位）| 数据位  |crc校验  |  应答位（隐性电平）|  帧尾	

## can帧仲裁

两个节点同时往can总线发数据，比较id位，出现一个0一个1时，0会把1盖掉，在can总线上就是0。1的节点停止传输变成接收的状态，等0的节点传输完毕再传输。（所以两个节点id不能一样，会错乱）

## crc校验

1.用多项式系数求余数

2.看多项式最高项系数给要校验的数据补0，补成最高项系数那么多项，按位异或得到一个结果

3.给这个结果再给他补0，按位异或，直到按位异或后等于0，得到最后的结果

4.在它前面补0，补成最高项系数那么多项。

